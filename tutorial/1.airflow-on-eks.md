```
export CLUSTER_NAME="training-on-eks"
```


### 1. IAM ë° Namespace ì¤€ë¹„ ###
ë¨¼ì € Airflowê°€ ì„¤ì¹˜ë  ê³µê°„ê³¼ S3 ë¡œê·¸ ì €ì¥ ë“±ì„ ìœ„í•œ IAM ì—­í• ì„ ìƒì„±í•©ë‹ˆë‹¤. (eksctl ì‚¬ìš©)
```
kubectl create namespace airflow

# S3 ì ‘ê·¼ ê¶Œí•œì„ ê°€ì§„ ServiceAccount ìƒì„± (IRSA)
eksctl create iamserviceaccount \
  --name airflow-sa \
  --namespace airflow \
  --cluster ${CLUSTER_NAME}\
  --role-name AirflowEKSRole \
  --attach-policy-arn arn:aws:iam::aws:policy/AmazonS3FullAccess \
  --approve
```

### 2. Git ì ‘ì† ì •ë³´(SSH Key) ì„¤ì • ###
Airflowê°€ Gitì— ì ‘ì†í•  ìˆ˜ ìˆë„ë¡ SSH Keyë¥¼ ì¿ ë²„ë„¤í‹°ìŠ¤ ì‹œí¬ë¦¿ìœ¼ë¡œ ë“±ë¡í•´ì•¼ í•œë‹¤.

![](https://github.com/gnosia93/mlops-on-eks/blob/main/images/github-deploy-key.png)
```
# 1. SSH í‚¤ ìƒì„± (ì´ë¯¸ ìˆë‹¤ë©´ ê±´ë„ˆëœ€)
ssh-keygen -t rsa -b 4096 -f ./airflow-git-key

# 2. ìƒì„±ëœ public key(.pub)ë¥¼ GitHub/GitLabì˜ 'Deploy Keys'ì— ë“±ë¡

# 3. Private Keyë¥¼ ì¿ ë²„ë„¤í‹°ìŠ¤ Secretìœ¼ë¡œ ìƒì„±
kubectl create secret generic airflow-git-ssh-secret \
  --from-file=gitSshKey=./airflow-git-key \
  -n airflow

kubectl get secret airflow-git-ssh-secret -n airflow -o yaml
```

### 3. values.yaml ì‘ì„± ###
Git-Sync í™œì„±í™”ì™€ ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ê²°ì„ í¬í•¨í•œ ì„¤ì • íŒŒì¼ì´ë‹¤. ê¹ƒí—ˆë¸Œ ë ˆí¬ì§€í† ë¦¬ì˜ ê²½ìš° ssh ì£¼ì†Œë¥¼ ë„£ì–´ì•¼ í•œë‹¤. 
```
cat <<'EOF' > values.yaml
executor: "KubernetesExecutor"

serviceAccount:
  create: false
  name: "airflow-sa"

# Git-Sync ì„¤ì • (S3 ëŒ€ì‹  Git ë¦¬í¬ì§€í† ë¦¬ì—ì„œ DAG ë¡œë“œ)
dags:
  gitSync:
    enabled: true
    repo: "git@github.com:gnosia93/mlops-on-eks.git"             # SSH ì£¼ì†Œ
    branch: "main"
    rev: "HEAD"
    depth: 1
    wait: 60  # 60ì´ˆë§ˆë‹¤ ë™ê¸°í™” ì²´í¬
    subPath: "dags"                                              # ë¦¬í¬ì§€í† ë¦¬ ë‚´ DAG íŒŒì¼ì´ ìˆëŠ” íŠ¹ì • í´ë” ê²½ë¡œ
    sshKeySecret: "airflow-git-ssh-secret"                       # 2ë‹¨ê³„ì—ì„œ ë§Œë“  ì‹œí¬ë¦¿ ì´ë¦„
EOF
```
```
helm repo add apache-airflow https://airflow.apache.org
helm repo update
helm install airflow apache-airflow/airflow --namespace airflow \
  --values values.yaml
```

### 4. ë‹¨ê³„: LLM íŒŒì´í”„ë¼ì¸ ê°œë°œ ì›Œí¬í”Œë¡œìš° ###
ì´ì œ ì„¤ì¹˜ê°€ ëë‚¬ìŠµë‹ˆë‹¤. ì•ìœ¼ë¡œ LLM íŒŒì¸íŠœë‹ ìë™í™”ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìˆœì„œë¡œ ì§„í–‰í•˜ë©´ ë©ë‹ˆë‹¤.
* ì½”ë“œ ìˆ˜ì •: ë¡œì»¬ IDEì—ì„œ DAG íŒŒì¼(ì˜ˆ: llm_finetune_dag.py)ì„ ì‘ì„±í•©ë‹ˆë‹¤.
* Git Push: git push origin mainìœ¼ë¡œ ì½”ë“œë¥¼ ì˜¬ë¦½ë‹ˆë‹¤.
* ìë™ ë°˜ì˜: EKSì— ë–  ìˆëŠ” Airflow Git-Sync ì»¨í…Œì´ë„ˆê°€ 60ì´ˆ ì´ë‚´ì— ìƒˆ ì½”ë“œë¥¼ ê°ì§€í•˜ì—¬ ì›¹ UIì— í‘œì‹œí•©ë‹ˆë‹¤.
* í•™ìŠµ ì‹¤í–‰: DAGê°€ ì‹¤í–‰ë˜ë©´ KubernetesPodOperatorê°€ GPU ë…¸ë“œì— í•™ìŠµìš© Podë¥¼ ë„ì›Œ íŒŒì¸íŠœë‹ì„ ì‹œì‘í•©ë‹ˆë‹¤.

### ğŸ’¡ ìš´ì˜ íŒ (2025) ###
* íŒŒì¼ êµ¬ì¡°: Git ë¦¬í¬ì§€í† ë¦¬ ë£¨íŠ¸ì— dags/ í´ë”ë¥¼ ë§Œë“¤ê³  ê·¸ ì•ˆì— íŒŒì¼ì„ ë„£ìœ¼ì„¸ìš”.
* ë³´ì•ˆ: RDS ë¹„ë°€ë²ˆí˜¸ ë“±ì€ values.yamlì— ì§ì ‘ ì ì§€ ë§ê³  ì¿ ë²„ë„¤í‹°ìŠ¤ Secretì„ ì—°ë™í•˜ì—¬ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì•ˆì „í•©ë‹ˆë‹¤.
* GPU ë…¸ë“œ: EKS ë…¸ë“œ ê·¸ë£¹ì— GPU ì¸ìŠ¤í„´ìŠ¤(Pê³„ì—´/Gê³„ì—´)ë¥¼ ì¶”ê°€í•˜ê³ , DAG ì½”ë“œ ë‚´ì—ì„œ nodeSelector: { "nvidia.com": "exists" }ë¥¼ ì„¤ì •í•´ í•™ìŠµ ì‘ì—…ì„ í•´ë‹¹ ë…¸ë“œë¡œ ë³´ë‚´ì•¼ í•©ë‹ˆë‹¤.


